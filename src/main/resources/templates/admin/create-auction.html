<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<!-- HEADER -->
<head th:replace="fragments/admin/header :: header">
    <script type="text/javascript">
        document.getElementById("auctionStart").value = getSavedValue("auctionStart");    // set the value to this input
        document.getElementById("auctionEnd").value = getSavedValue("auctionEnd");   // set the value to this input
        /* Here you can add more inputs to set value. if it's saved */

        //Save the value function - save it to localStorage as (ID, VALUE)
        function saveValue(e){
            var id = e.id;  // get the sender's id to save it .
            var val = e.value; // get the value.
            localStorage.setItem(id, val);// Every time user writing something, the localStorage's value will override .
        }

        //get the saved value function - return the value of "v" from localStorage.
        function getSavedValue  (v){
            if (!localStorage.getItem(v)) {
                return "";// You can change this to your defualt value.
            }
            return localStorage.getItem(v);
        }
    </script>
</head>

<body>

<!-- TOPNAV -->
<nav th:replace="fragments/admin/topnav :: topnav"></nav>

<!-- CONTENT -->
<div class="container-fluid">
    <div class="row">

        <!-- SIDENAV -->
        <div class="col-md-2">
            <ul th:replace="fragments/admin/sidenav :: sidenav"></ul>
        </div>

        <!-- CONTENT -->
        <div class="col-md-10">
            <h2>Create auction</h2>
            <div>
                    <label for="auctionStart">Start: </label>
                    <input type="datetime-local" id="auctionStart" name="auctionStartDate" form="create-auction" onchange='saveValue(this);' required>
                    <label for="auctionEnd">End: </label>
                    <input type="time" id="auctionEnd" name="auctionEndTime" form="create-auction" onchange='saveValue(this);' required>
                <div th:if="${INVALID_AUCTION != null}">
                    <p th:text="${INVALID_AUCTION}" style="color: red;"></p>
                </div>
            </div>
            <table>
                <tr>
                    <th>Security type</th>
                    <th>Security term</th>
                    <th>Total amount</th>
                    <th>Issue Date</th>
                    <th>Maturity Date</th>
                </tr>
                <tr th:each="security : ${newAuction.treasurySecurityList}" th:object="${security}">
                    <td th:text="*{securityType}"></td>
                    <td th:text="*{securityTerm}"></td>
                    <td th:text="*{totalAmount}"></td>
                    <td th:text="*{issueDate}"></td>
                    <td th:text="*{maturityDate}"></td>
                    <td><form th:action="'/admin/auctions/remove-security/' + *{securityTerm} + '_' + *{securityType}" method="post"><button type="submit" class="btn btn-primary">Remove</button></form></td>
                </tr>
            </table>
            <div>
                <form action="/admin/auctions/add-security" method="post" id="addSecurityForm"></form>
                <table>
                    <tr>
                        <td><select id="slct1" name="securityType" form="addSecurityForm" onchange="populate(this.id, 'slct2')">
                            <option th:value="${errorSecurityValue != null} ? ${errorSecurityValue.securityType} : 'none'" selected disabled hidden th:text="${errorSecurityValue != null} ? ${errorSecurityValue.securityType} : 'Select security'"></option>
                            <option value="T-Bill">T-Bill</option>
                            <option value="T-Note">T-Note</option>
                            <option value="T-Bond">T-Bond</option>
                        </select></td>
                        <td><select id="slct2" name="securityTerm" form="addSecurityForm">
                            <option th:value="${errorSecurityValue != null} ? ${errorSecurityValue.securityTerm} : 'none'" selected disabled hidden th:text="${errorSecurityValue != null} ? ${errorSecurityValue.securityTerm} : 'Select term'"></option>
                        </select></td>
                        <td><input type="number" name="totalAmount" form="addSecurityForm" th:value="${errorSecurityValue != null} ? ${errorSecurityValue.totalAmount} : ''"></td>
                        <td><input type="datetime-local" name="issueDate" form="addSecurityForm" th:value="${errorSecurityValue != null} ? ${#temporals.formatISO(errorSecurityValue.issueDate)} : ''"></td>
                        <td><button type="submit" form="addSecurityForm" class="btn btn-primary">Add</button></td>
                    </tr>
                    <tr>
                        <td><span th:if="${INVALID_SECURITY_ERROR != null}" th:text="${INVALID_SECURITY_ERROR}" style="color: red;"></span></td>
                        <td><span th:if="${SECURITY_TERM_ERROR != null}" th:text="${SECURITY_TERM_ERROR}" style="color: red;"></span></td>
                        <td><span th:if="${TOTALAMOUNT_ERROR != null}" th:text="${TOTALAMOUNT_ERROR}" style="color: red;"></span></td>
                        <td><span th:if="${ISSUE_DATE_ERROR != null}" th:text="${ISSUE_DATE_ERROR}" style="color: red;"></span></td>
                    </tr>
                </table>
                <form action="/admin/auctions/create" method="post" id="create-auction"><button type="submit" class="btn btn-primary">Create auction</button></form>
            </div>
        </div>
    </div>
</div>
<!-- FOOTER -->
<footer th:replace="fragments/admin/footer :: footer"></footer>
</body>
</html>